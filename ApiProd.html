<li><a href="ApiProd.html">Main Menu</a></li><!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Alchimie du Jeu</title>
 <link rel="stylesheet" href="styles/Fixed_banner.css"/>
 <link rel="stylesheet" href="styles/ApiProd.css"/>

</head>
<body>
 <div class="fixed-banner">
    <img src="./assets/logo_hexag.webp" alt="Logo asso" class="logo" />
    <h1>Alchimie du Jeu</h1>
  <button id="menu-toggle-button" aria-expanded="false" aria-controls="fixed-sidebar">
        ☰ </button>
 </div>

  <div class="main-layout">
    <div class="fixed-sidebar">
        <nav>
            <ul>
				<li><a href="HomePage.html">L'association</a></li>
				<li><a href="Adhesion.html">Adhérez !</a></li>
				<li><a href="NousContacter.html">Notre équipe et contact</a></li>
                <li><a href="ApiProd.html">Main Menu</a></li>
                <li><a href="ProfilePage.html">Profile</a></li>
            </ul>
            <hr>
            <ul>
	            <li><a href="Mentions_Légales.html">Mentions Légales</a></li>
                <li><a href="Bookresa.html"> Créer Reservation</a></li>
		        <li><a href="#">Réservation En Cours</a></li>
            </ul>          
        </nav>
    </div>  
  
  <div class="main-content">  
   
    <div class="containerMid"> 
     
       <div class="item">        
         <div class="containerMid">            
           <div class="item2" > 
             <h12> jeu preferé de : Mr B</h12>
             <div id="result5">TODO Api authent + extract sur autre base de doonnees les resultats</div>
           </div>    
           <div class="item2"> 
             <div id="chart_div" ></div>
           </div> 
        </div>
     </div>
      
       <div class="item">          
          <div id="donutchart" ></div>
       </div>
    </div>   
  
   <div class="containerMid">
       <div class="item"> 
        
          <h4>My Dropdown List</h4>

    <label for="myDropdown">Quel jeu :</label>
    <select id="myDropdown" class="custom-dropdown">
        <option value="Flowers">Jeu1</option>
        <option value="Dekal">Jeu2</option>
        <option value="Pixies">Jeu3</option>
    </select>

	<button id="infoButton">Info de la sélection</button>
 <button id="empruntButton">Emprunte la sélection</button>
 <button id="rendButton">Rend la sélection</button>
	<div id="ecranJeu">INFO ICI</div>
        
       </div>
      
     <div class="item">          
         <h4> Lister Jeu </h4>
         <button id ="Bouton2" >ListAll !</button>
         <div id="result2">Résultat de l'API2 apparaîtra ici.</div>
     </div>
  </div>   
      
    <hr>  
    <h2> Saisie Champ bouto2n </h2>
    <button id ="RESET" onclick="resetData('result2','ecranJeu')">Reset !</button>
    
    <hr>
    
    <div class="containerMid">
       <input type="string" name="Jeu" id="Saisie_Jeu" placeholder="Jeu à choisir"/>
       <div id="result3">Résultat du champ apparaîtra ici!!!!.</div>
    </div>  
    <hr>
   
</div> 
      
 <script>
//bbfonctions
	 const jwtToken = sessionStorage.getItem('jwtToken');
async function recupData2(urlJeu,jeuCall="/listerTout",yesOrno="none") {
            const data = {              
                    Jeu: jeuCall,
                    Emprunt: yesOrno,
                    code: 1               
            };
            try {
                const response = await fetch(urlJeu, {
                    method: 'POST',
                    headers: {
						'Authorization': 'Bearer ' + jwtToken, 
                        'Content-Type': 'application/json'
                        //TODO ajouter securite header et token
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                    return 'errooor';
                }

                const responseData = await response.json(); 
console.log("AVANT");  
console.log("Mes données avant traitement :", responseData);               
                return responseData
            } catch (error) {
                console.error('Erreur lors de la récupération des données:', error);
                return 'Erreur lors de la récupération des données fct recupData2.';
            }
        }

 async function resetData(affich1,affich2) {
            document.getElementById(affich1).innerText = 'Reset';
            document.getElementById(affich2).innerText = 'Reset';
         //   const test = await recupData2('http://172.16.254.30:5678/webhook/5a5e1bde-ac93-4a94-838f-9aa7ee57e519');
        //    document.getElementById(affich2).innerText = test[0].Jeu[3];
        }
 
function displayData(selectorCSS, data) {
            const element = document.querySelector(selectorCSS);
            if (element) {
                element.textContent = JSON.stringify(data, null, 2);
            
            } else {
                console.error(`Erreur: L'élément avec le sélecteur "${selectorCSS}" est introuvable.`);
            }
        }
 
 
class BoutonAction {
    constructor(boutonID,divAssociee,apiUrl,listederoulante = 'undefined',emprunt = 'none'){
     this.bouton = document.getElementById(boutonID);
     this.boutonDiv = divAssociee;
     this.apiUrl = apiUrl;
     this.listeDeroulante = document.getElementById(listederoulante);
     this.isEmprunte = emprunt;
     this.init();     
    }
 
    init() {
        if (this.bouton) {
            this.bouton.addEventListener('click', this.handleClick.bind(this));
        } else {
            console.error(`Le bouton avec l'ID '${boutonID}' est introuvable.`);
        }
    }
 
    async handleClick() {
        try {                                               
           if (this.listeDeroulante === null ) { // Utilisation de '===' pour une comparaison stricte
               const data = await recupData2(this.apiUrl,'/listerTout',this.isEmprunte);
             //TEST
             const jeux = data[0].Jeu;

        // Créer une chaîne avec chaque jeu sur une nouvelle ligne
        const jeuxFormates = jeux.join('  -  ');
             //  displayData(this.boutonDiv, data);
            displayData(this.boutonDiv, jeuxFormates);
           }else{  
               	const data = await recupData2(this.apiUrl,this.listeDeroulante.value,this.isEmprunte);
               displayData(this.boutonDiv, data);
           	
           }      	
        } catch (error) {
           displayData(boutonDiv, { error: `Impossible de charger les données: ${error.message}` });
      }
    }    
}
//class butoon
const urlJeu = 'http://172.16.254.30:5678/webhook/5a5e1bde-ac93-4a94-838f-9aa7ee57e519';     
const listerToutBouton = new BoutonAction('Bouton2','#result2',urlJeu);          
const infoBouton = new BoutonAction('infoButton','#ecranJeu',urlJeu,'myDropdown');          
const empruntBouton = new BoutonAction('empruntButton','#ecranJeu',urlJeu,'myDropdown','yes');          
const rendBouton = new BoutonAction('rendButton','#ecranJeu',urlJeu,'myDropdown','no');          

//peuplerListeDeroulante();
 
 //logique de gestion des events hors bouton
document.addEventListener('DOMContentLoaded', () => {
    const myButton = document.getElementById('myButt');
    const targetDiv = '#result1';
    const apiUrl = 'http://172.16.254.30:5678/webhook/5a5e1bde-ac93-4a94-838f-9aa7ee57e519';
    
    if (myButton) {//bouton qui recup la saisie ligne
        myButton.addEventListener('click', async () => {
            try {                                               
                const champJeu2 = document.getElementById('Saisie_Jeu').value.toString(); //gerer le caz vide
                const data = await recupData2(apiUrl,champJeu2);
                displayData(targetDiv, data);
                } catch (error) {
                displayData(targetDiv, { error: `Impossible de charger les données: ${error.message}` });
                }
        });
    } else {
        console.error("Le bouton avec l'ID 'myButt' est introuvable.");
        displayData(targetDiv, { error: `Impossible probleme button}` });
    }            
 
	
	peuplerListeDeroulante();
  
 
  })
 
  //teste dorpdown
const maListeDeJeuxSimples = ["Flowers", "Dekal", "Pixies", "Explorers", "Guardians", "Legends"];


async function peuplerListeDeroulante() {
	const listeDeroulante = document.getElementById('myDropdown');
   	try {                                               
        	const test = await recupData2('http://172.16.254.30:5678/webhook/5a5e1bde-ac93-4a94-838f-9aa7ee57e519');
		const jeux =test[0].Jeu;

		if (!Array.isArray(jeux) || jeux.length === 0) {
            		console.warn("Le tableau de jeux est vide ou mal formaté.");
            		// Gérer ce cas (par exemple, afficher un message à l'utilisateur)
            		return; // Sortir de la fonction si pas de jeux
        		}
  		const test2 = test[0].Jeu[3];
  		console.log(test2);

		listeDeroulante.innerHTML = '';
		jeux.forEach(jeu => {
            		const option = document.createElement('option'); // Crée un nouvel élément <option>
            			option.value = jeu; // La valeur de l'option (ce qui sera envoyé si le formulaire est soumis)
            			option.textContent = jeu; // Le texte visible dans la liste déroulante
            			listeDeroulante.appendChild(option); // Ajoute l'option au <select>
        		})
		const defaultOption = document.createElement('option');
        	defaultOption.value = "";
        	defaultOption.textContent = "Sélectionner un jeu...";
        	defaultOption.selected = true; // Pour la sélectionner par défaut
        	defaultOption.disabled = true; // Pour qu'elle ne soit pas sélectionnable après le choix initial
        	listeDeroulante.prepend(defaultOption);
                } catch (error) {
                console.log("aaaaaaa(€(€)39€_!4)€8aaaaaaaaaaaaaa");
        }
}

peuplerListeDeroulante();
   
      </script>
    
       <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <script type="text/javascript">
      google.charts.load('current', {'packages':['gauge','corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['Victory', 80],
        ]);

        var options = {
         // width: 500, height: 220,
          redFrom: 0, redTo: 25,
         yellowFrom: 20, yellowTo: 50,
          greenFrom:75, greenTo: 100,
          minorTicks: 5
        };

        var chart = new google.visualization.Gauge(document.getElementById('chart_div'));

        chart.draw(data, options);

        setInterval(function() {
          data.setValue(0, 1, 40 + Math.round(60 * Math.random()));
          chart.draw(data, options);
        }, 13000);
        setInterval(function() {
          data.setValue(1, 1, 40 + Math.round(100 * Math.random()));
          chart.draw(data, options);
        }, 5000);
      //2eme chart
     var data2 = google.visualization.arrayToDataTable([
          ['Type de jeu', 'Nb de parties'],
           ['Cartes', 11],
          ['Reflexion', 2],
          ['Strategie', 2],
          ['Aleatoire', 4],
          ['Dés', 7]
        ]);

        var options2 = {
          title: 'Top 5 type de jeu',
          pieHole: 0.4,
          backgroundColor: '#ddd',
          chartArea: {
                    height: '100%', // La hauteur de la zone de tracé est de 60% de la hauteur totale du conteneur
                    width: '100%', // La largeur de la zone de tracé est de 80% de la largeur totale du conteneur
                    left: '0', // Décalage depuis le bord gauche du conteneur (en pourcentage)         
                },
          
        };

        var chart2 = new google.visualization.PieChart(document.getElementById('donutchart'));
        chart2.draw(data2, options2);     
          
      }
         

    </script>

<script src=./scripts/JS_sitee.js> </script>

    

    <script>
        // Fonction pour récupérer un cookie
      const userName = sessionStorage.getItem('userName');  

        // Récupérer le username et mettre à jour le texte
        const heading = document.querySelector('h12');

        if (userName) {
            heading.textContent = `Bienvenue ${userName}, sur cette page tu pourras emprunter des jeu et savoir quels jeu sont disponibles`;
        } else {
            heading.textContent = "Ceci est l'espace <br> Invité, les donnees aparaissant sont factices";
        }
    </script>   
    
    
  </body>
</html>

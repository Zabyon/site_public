<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Azurealpes® Games Booking</title>
 <link rel="stylesheet" href="styles/Fixed_banner.css"/>
 <link rel="stylesheet" href="styles/Profile_Page.css"/>


</head>
<body>
 <div class="fixed-banner">
    <img src="https://cdn.leonardo.ai/users/65caef68-b2fc-4b3c-aea2-9b83729fe324/generations/00d49c31-cda1-4d82-a3ff-633dbea000ae/variations/Default_Generate_a_vibrant_highresolution_3D_Logo_that_remind_0_00d49c31-cda1-4d82-a3ff-633dbea000ae_0.png" alt="Mon image de test" class="logo" />
    <h1>Azurealpes ®</h1>
    <button id="menu-toggle-button" aria-expanded="false" aria-controls="fixed-sidebar">
        ☰ </button>
 </div>

  <div class="main-layout">
    <div class="fixed-sidebar">
        <nav>
            <ul>
				<li><a href="HomePage.html">L'association</a></li>
				<li><a href="Adhesion.html">Adhérez !</a></li>
                <li><a href="ApiProd.html">Main Menu</a></li>
                <li><a href="ProfilePage.html">Profile</a></li>
            </ul>
            <hr>
            <ul>
                <li><a href="Mentions_Légales.html">Mentions Légales</a></li>
                <li><a href="Bookresa.html">Créer Réservation</a></li>
		<li><a href="#">Réservation En Cours</a></li>
            </ul>
          
        </nav>
    </div>  
  
  <div class="main-content">
    <!-- Div centrale avec le texte -->
    <div style="text-align: center; margin: 20px auto; max-width: 100%; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: white;">
        <p style="font-size: 16px; line-height: 1.5;">
            Mail : example@mail.com<br>
         <hr>
            ID (date de création) : 2025-10-09-123456789<br>
            Pour changer de pseudo.<br>
         Entrez votre nouveau pseudo en bas<br>
        </p>

        <!-- Input et bouton pour l'API -->
        <div style="margin: 20px 0;">
            <input type="text" placeholder="Entrez votre texte ici..." style="width: 70%; height: 30px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
            <button onclick="alert('Appel API Update Pseudo simulé')" style="width: 28%; height: 48px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Changer de Pseudo (API)</button>
        </div>

        <!-- Bouton rouge "Supprimer le compte" -->
        <div style="margin: 20px 0;">
           <button
    onclick="showDeleteModal()"
    style="width: 100%; height: 40px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;"
>
    Supprimer le compte
</button>
        </div>
    </div>


<!-- Modale de confirmation (masquée par défaut) -->
<div id="confirmModal" class="ModaleProfile">
 
    <div style="
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        text-align: center;
    ">
        <h3 style="color: #f44336;">⚠️ Attention</h3>
		<p>Cette action est définitive et supprimera votre compte. Voulez-vous continuer ?</p>
		<p>Si oui Merci de rentrer votre mot de passe pour Confirmer et appuyer sur Supprimer définitivement</p>
		<input type="password" id="apiPasswordInput">
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
            <button id="cancelDelete" style="
                padding: 8px 16px;
                background-color: #ccc;
                color: black;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            ">Annuler</button>
            <button id="confirmDelete">Supprimer définitivement</button>
        </div>
    </div>
</div>


<!-- Modale de succès -->
<div id="successModal" class="ModaleProfile">
    <div style="
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        text-align: center;
    ">
        <h3 style="color: #4CAF50;">✅ Succès</h3>
        <p>Votre compte a été supprimé avec succès.</p>
        <button onclick="document.getElementById('successModal').style.display = 'none'; window.location.href = '/';"
                style="margin-top: 20px; padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Retour à l'accueil
        </button>
    </div>
</div>

<!-- Modale d'erreur -->
<div id="errorModal" class="ModaleProfile">
    <div style="
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        text-align: center;
    ">
        <h3 style="color: #f44336;">❌ Erreur</h3>
        <p id="errorMessage">Une erreur est survenue lors de la suppression du compte.</p>
        <button onclick="document.getElementById('errorModal').style.display = 'none';"
                style="margin-top: 20px; padding: 8px 16px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Fermer
        </button>
    </div>
</div>

</div>

   <script>
    const userName = sessionStorage.getItem('userName');
	
    // Affiche la modale de confirmation
    function showDeleteModal() {
        document.getElementById('confirmModal').style.display = 'flex';
    }

    // Cache la modale de confirmation (annulation)
    document.getElementById('cancelDelete').onclick = function() {
        document.getElementById('confirmModal').style.display = 'none';
    };

    // Action de suppression (appel API simulé)
    document.getElementById('confirmDelete').onclick = function() {
		const apiPassword = document.getElementById('apiPasswordInput').value;
        // Cache la modale de confirmation
        document.getElementById('confirmModal').style.display = 'none';        
        apiCall(userName, apiPassword);
        // Simule un appel API (à remplacer par fetch/axios) - Gardé pour la logique de modale
        setTimeout(() => {
            // Simule une réponse réussie (remplace par la logique réelle)
            const success = Math.random() > 0.4; // 60% de chance de succès pour la démo

            if (success) {
                document.getElementById('successModal').style.display = 'flex';
            } else {
                document.getElementById('errorMessage').textContent = 'Échec de la suppression. Veuillez réessayer.';
                document.getElementById('errorModal').style.display = 'flex';
            }
        }, 1000);
    };
       
    //n8n.labtest06.freeddns.org/
   
    // Fonction unifiée pour l'appel API
    async function apiCall(email, password) {
        const url = 'http://172.16.254.30:5678/webhook/45f098af-3eb6-43e2-9dba-7b875824779c';
        const data = {
            'userName': email,
            'password': password,
            'removU': true
        
        };

        try {
            const response = await fetch(url, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error(`Erreur HTTP: ${response.status}`);
            }

            const responseData = await response.json();
            console.log('Réponse de l\'API:', responseData);
            const jwtToken = responseData[0]?.jwtToken;
            // Placez ici la logique de succès (affichage de la successModal)
            // document.getElementById('successModal').style.display = 'flex'; 

        } catch (error) {
            console.error('Erreur lors de la récupération des données:', error);
            // Correction de la chaîne de caractères et de l'indentation
            document.getElementById('errorMessage').textContent = 'Échec de l\'API. Veuillez réessayer.';
            document.getElementById('errorModal').style.display = 'flex';
        }
    };     
</script>

<script src=./scripts/JS_sitee.js> </script>


  </body>
</html>
